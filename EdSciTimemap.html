<!DOCTYPE HTML PUBLIC "-//W3C//DTD XHTML 1.1//EN" "http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd">
<html><head>
    <meta http-equiv="Content-type" content="text/html; charset=UTF-8">
    <title>Edinburgh Science Festival Timemap</title>
    <link rel="stylesheet" href="./master.css" type="text/css" media="screen" charset="utf-8">

    <script type="text/javascript" src="http://code.jquery.com/jquery-1.6.2.js"></script>
    <script type="text/javascript" src="http://openlayers.org/api/OpenLayers.js"></script> 
    <script type="text/javascript" src="http://timemap.googlecode.com/svn/tags/2.0.1/lib/mxn/mxn.js?(openlayers)"></script> 
    <script type="text/javascript" src="http://static.simile.mit.edu/timeline/api-2.3.0/timeline-api.js?bundle=true"></script>
    <script type="text/javascript" src="http://timemap.googlecode.com/svn/tags/2.0.1/src/timemap.js"></script>  
    <script type="text/javascript" src="http://timemap.googlecode.com/svn/tags/2.0.1/src/manipulation.js"></script>  
    <script type="text/javascript" src="http://timemap.googlecode.com/svn/tags/2.0.1/src/param.js"></script>
    <script type="text/javascript" src="http://timemap.googlecode.com/svn/tags/2.0.1/src/loaders/xml.js"></script>
    <script type="text/javascript" src="http://timemap.googlecode.com/svn/tags/2.0.1/src/loaders/kml.js"></script> 

   <!-- Load the customisations required for the zoombar -->
   <script src="./timeline_zoom_overrides.js" type="text/javascript"></script>
   <script src="./TimelineBandZoomBar.js" type="text/javascript"></script>
   <script src="./TimelineBandPanControl.js" type="text/javascript"></script>

   <link rel="stylesheet" href="./timemaps.css" type="text/css">
   <link rel="stylesheet" href="./TimelineBandZoomBar.css" type="text/css">
   <link rel="stylesheet" href="./TimelineBandPanControl.css" type="text/css">
     
   <!-- Load the customisations required to get the correct multiple event behaviour -->
   <script src="./timemap_overrides.js" type="text/javascript"></script>

   <!-- Load mobile browser detection so that the correct directions string can be set -->
   <script type="text/javascript" src="./detectmobilebrowser.js"></script>
   
   <script type="text/javascript">

               var tm_fjz;
	       var directionsString = '<a href="http://maps.google.com/maps?ll={{directions_link}}&spn=0.025,0.025&t=m&q=to {{directions_link}}" target="_blank">(get directions)</a></div>';

               if($.browser.mobile == true){
	           var directionsString = '<a href="http://maps.google.com/maps?ll={{directions_link}}&spn=0.025,0.025&t=m&q={{directions_link}}" target="_blank">(get directions)</a></div>';
	       }
    
	       testDataDisplayed = function(){
	       	var scrollToDate= "Mon Apr 02 2012 00:00:00 GMT-0000";
	                   tm_fjz.scrollToDate(scrollToDate, true);
		   }
		    
	      $(function() {

	var theme2 = Timeline.ClassicTheme.create();
	theme2.autoWidth = false; 

	theme2.timeline_start = new Date(Date.UTC(2012, 2, 20));
	theme2.timeline_stop  = new Date(Date.UTC(2012, 3, 30));
	theme2.mouseWheel = 'zoom';
	theme2.autoWidth = false; 
	theme2.color = "red";
	
	var theme4 = Timeline.ClassicTheme.create();
	theme4.icon = "./img/atomIcon.png";
	
	var theme5 = Timeline.ClassicTheme.create();
	theme5.icon = "./img/Gear_7.png";

        var theme3 = Timeline.ClassicTheme.create();
	theme3.icon = "./img/Movie_stub_film.png";

	var d2= "Mon Apr 02 2012 00:00:00 GMT-0000";

        var greatestMag2 = new Object();
	greatestMag2.pixelsPerInterval = 200;
	greatestMag2.unit = Timeline.DateTime.HOUR;
	var leastMag2 = new Object();
	leastMag2.pixelsPerInterval = 50;
	leastMag2.unit = Timeline.DateTime.DAY;
	var theZoomSteps2 = initZoomSteps(12, greatestMag2, leastMag2);
	var theZoomIndex2 = 5;
	var theIntervalUnit2 = theZoomSteps2[theZoomIndex2].unit;
	var theIntervalPixels2 = theZoomSteps2[theZoomIndex2].pixelsPerInterval;

        var theMapZoom2 = 13;
        var lon2 = -3.188463;
	var lat2 = 55.950101;
	var theMapCenter2 = new mxn.LatLonPoint()
	theMapCenter2.lon = lon2;
	theMapCenter2.lat = lat2;
	theMapCenter2.lng = lon2;

	tm_fjz = TimeMap.init({
		mapId: "map_fjz",               // Id of map div element (required)
		timelineId: "timeline_fjz",     // Id of timeline div element (required)
		scrollTo: d2,
		options: {
		    eventIconPath: "timemap/images/",
		    centerOnItems: false,
		    mapCenter: theMapCenter2,
		    mapZoom: theMapZoom2
		},
		datasets: [
		   {
			title: "Edinburgh Science Festival Talks",
			theme: theme4,
			type: "kml",     // Data to be loaded in KML - must be a local URL
			options: {
			    url: "./kml/events_talks.kml", // KML file to load
			   extendedData: ["LocationName",  "DateString", "TimeString", "Url","LatLonStr"],
			    tagMap: {
				"LatLonStr":"directions_link",
				"Url":"wiki_link"
			    },
			    openInfoWindow: TimeMapItem.openInfoWindowCombined,
			     // template for loaded data
			    infoTemplate: '<div style="font-size:small"><strong>{{LocationName}}</strong><br>' +
			                  directionsString + 
					  '<p><div style="font-size:small"><strong><a href="{{wiki_link}}" target="_blank">{{title}}</a></strong><br>' +
					  '<strong>Time: </strong>{{TimeString}}<br>' +
					  '<strong>Date: </strong>{{DateString}}</div></p>'
			}
		    },
		{
			title: "Edinburgh Science Festival Films",
			theme: theme3,
			type: "kml",     // Data to be loaded in KML - must be a local URL
			options: {
			    url: "./kml/events_films.kml", // KML file to load
			   extendedData: ["LocationName",  "DateString", "TimeString", "Url","LatLonStr"],
			    tagMap: {
				"LatLonStr":"directions_link",
				"Url":"wiki_link"
			    },
			    openInfoWindow: TimeMapItem.openInfoWindowCombined,
			     // template for loaded data
			    infoTemplate: '<div style="font-size:small"><strong>{{LocationName}}</strong><br>' +
			                  directionsString + 
					  '<p><div style="font-size:small"><strong><a href="{{wiki_link}}" target="_blank">{{title}}</a></strong><br>' +
					  '<strong>Time: </strong>{{TimeString}}<br>' +
					  '<strong>Date: </strong>{{DateString}}</div></p>'
			}
		    },
		    {
			title: "Edinburgh Science Festival Activities",
			theme: theme5,
			type: "kml",     // Data to be loaded in KML - must be a local URL
			options: {
			    url: "./kml/events_activities.kml", // KML file to load
			   extendedData: ["LocationName",  "DateString", "TimeString", "Url","LatLonStr"],
			    tagMap: {
				"LatLonStr":"directions_link",
				"Url":"wiki_link"
			    },
			    openInfoWindow: TimeMapItem.openInfoWindowCombined,
			     // template for loaded data
			    infoTemplate: '<div style="font-size:small"><strong>{{LocationName}}</strong><br>' +
			                  directionsString + 
					  '<p><div style="font-size:small"><strong><a href="{{wiki_link}}" target="_blank">{{title}}</a></strong><br>' +
					  '<strong>Time: </strong>{{TimeString}}<br>' +
					  '<strong>Date: </strong>{{DateString}}</div></p>'
			}
		    },
		    {
			title: "Edinburgh Science Festival Shows",
			theme: theme4,
			type: "kml",     // Data to be loaded in KML - must be a local URL
			options: {
			    url: "./kml/events_shows.kml", // KML file to load
			   extendedData: ["LocationName",  "DateString", "TimeString", "Url","LatLonStr"],
			    tagMap: {
				"LatLonStr":"directions_link",
				"Url":"wiki_link"
			    },
			    openInfoWindow: TimeMapItem.openInfoWindowCombined,
			     // template for loaded data
			    infoTemplate: '<div style="font-size:small"><strong>{{LocationName}}</strong><br>' +
			                  directionsString + 
					  '<p><div style="font-size:small"><strong><a href="{{wiki_link}}" target="_blank">{{title}}</a></strong><br>' +
					  '<strong>Time: </strong>{{TimeString}}<br>' +
					  '<strong>Date: </strong>{{DateString}}</div></p>'
			}
		    },
		    {
			title: "Edinburgh Science Festival Tours",
			theme: theme4,
			type: "kml",     // Data to be loaded in KML - must be a local URL
			options: {
			    url: "./kml/events_tours.kml", // KML file to load
			   extendedData: ["LocationName",  "DateString", "TimeString", "Url","LatLonStr"],
			    tagMap: {
				"LatLonStr":"directions_link",
				"Url":"wiki_link"
			    },
			    openInfoWindow: TimeMapItem.openInfoWindowCombined,
			     // template for loaded data
			    infoTemplate: '<div style="font-size:small"><strong>{{LocationName}}</strong><br>' +
			                  directionsString + 
					  '<p><div style="font-size:small"><strong><a href="{{wiki_link}}" target="_blank">{{title}}</a></strong><br>' +
					  '<strong>Time: </strong>{{TimeString}}<br>' +
					  '<strong>Date: </strong>{{DateString}}</div></p>'
			}
		    },
		    {
			title: "Edinburgh Science Festival Workshops",
			theme: theme5,
			type: "kml",     // Data to be loaded in KML - must be a local URL
			options: {
			    url: "./kml/events_workshops.kml", // KML file to load
			   extendedData: ["LocationName",  "DateString", "TimeString", "Url","LatLonStr"],
			    tagMap: {
				"LatLonStr":"directions_link",
				"Url":"wiki_link"
			    },
			    openInfoWindow: TimeMapItem.openInfoWindowCombined,
			     // template for loaded data
			    infoTemplate: '<div style="font-size:small"><strong>{{LocationName}}</strong><br>' +
			                  directionsString + 
					  '<p><div style="font-size:small"><strong><a href="{{wiki_link}}" target="_blank">{{title}}</a></strong><br>' +
					  '<strong>Time: </strong>{{TimeString}}<br>' +
					  '<strong>Date: </strong>{{DateString}}</div></p>'
			}
		    } 
		],				
		bandInfo: [
		    {
		       width:          "85%", 
				intervalUnit:   theIntervalUnit2, 
				intervalPixels: theIntervalPixels2,
				date:           d2,
				theme:          theme2,
				layout:         'original' ,  // original, overview, detailed
				zoomIndex:      theZoomIndex2,
				zoomSteps:      theZoomSteps2
		     } ,
		                 {
               width:          "15%", 
               intervalUnit:   Timeline.DateTime.WEEK, 
		       intervalPixels: 150,
               showEventText:  false
            }
		]
	});
	
/*	            {
               width:          "85%", 
               intervalUnit:   Timeline.DateTime.DAY, 
		       intervalPixels: 100
            },
            {
               width:          "15%", 
               intervalUnit:   Timeline.DateTime.WEEK, 
		       intervalPixels: 150,
               showEventText:  false,
               trackHeight:    0.2,
               trackGap:       0.2
            }*/

  Timeline.OriginalEventPainter.prototype._showBubble = function(x, y, evt) {
	  evt.item.fromTimeline = true;
	  evt.item.openInfoWindow();
   };
   
   tm_fjz.addFilter("timeline", function(item) {
        // determine whether the item should be shown, based on map position
      var bounds = item.map.getBounds();
        // note that this isn't going to work well for polygons and polylines
        return bounds.contains(item.getInfoPoint());
    });
    
    // add a listener to make the filter run when the map bounds change
   tm_fjz.map.addEventListener("moveend", function() {
       tm_fjz.filter("timeline");
   });
    
	var theTimeline_fjz = tm_fjz.timeline;
	var theBandNo_fjz = 0;
	
	var tlZoomBar_fjz = new TimelineBandZoomBar(theTimeline_fjz, theBandNo_fjz);
	theTimeline_fjz.ZoomBar = tlZoomBar_fjz; 
	
	var tlPanControl_fjz = new TimelineBandPanControl(theTimeline_fjz, theBandNo_fjz);
	theTimeline_fjz.PanControl = tlPanControl_fjz; 
	
	$('#activity_checkbox').bind('click', function() {
	        var ctivityDataset = tm_fjz.datasets["ds2"];
		if($('#activity_checkbox').is(':checked')){
			activityDataset.show();
              } else {
	      		activityDataset.hide();
	      }
         });
	 
	$('#film_checkbox').bind('click', function() {
	        var filmDataset = tm_fjz.datasets["ds1"];
		if($('#film_checkbox').is(':checked')){
			filmDataset.show();
              } else {
	      		filmDataset.hide();
	      }
         });
	 
	$('#show_checkbox').bind('click', function() {
	        var showDataset = tm_fjz.datasets["ds3"];
		if($('#show_checkbox').is(':checked')){
			showDataset.show();
              } else {
	      		showDataset.hide();
	      }
         });
	 
	$('#talk_checkbox').bind('click', function() {
	        var talkDataset = tm_fjz.datasets["ds0"];
		if($('#talk_checkbox').is(':checked')){
			talkDataset.show();
              } else {
	      		talkDataset.hide();
	      }
         });
	 
	$('#tour_checkbox').bind('click', function() {
	        var tourDataset = tm_fjz.datasets["ds4"];
		if($('#tour_checkbox').is(':checked')){
			tourDataset.show();
              } else {
	      		tourDataset.hide();
	      }
         });

	$('#workshop_checkbox').bind('click', function() {
	        var workshopDataset = tm_fjz.datasets["ds5"];
		if($('#workshop_checkbox').is(':checked')){
			workshopDataset.show();
              } else {
	      		workshopDataset.hide();
	      }
         });
	 
	var talkDataset = tm_fjz.datasets["ds0"];
	var filmDataset = tm_fjz.datasets["ds1"];
	var activityDataset = tm_fjz.datasets["ds2"];
	var showDataset = tm_fjz.datasets["ds3"];
	var tourDataset = tm_fjz.datasets["ds4"];
	var workshopDataset = tm_fjz.datasets["ds5"];

	//activityDataset.hide();
	//filmDataset.hide();
	//showDataset.hide();
	//talkDataset.hide();
	//tourDataset.hide();
	//workshopDataset.hide();
});

    </script>
   </head>
  <body>
    <div id="wrapper">
      <div id="content">	
	<h2 id="Ed_sci_festival_timemap">Edinburgh Science Festival Timemap</h2>
	
	<p>
	Below is a timemap (combined timeline and map) showing the talks that are part of the Edinburgh Science Festival. 
	It allows you to search for events in an area for a certain time frame. 
	To use it you pan/zoom either the map or timeline to include the area you want and the dates you want.
	If you click on an item an information bubble will pop up. 
	This shows the venue name and a directions link (clicking on this will allow you to get directions from where you are to the venue), 
	information about the event and a link to it on the <a href="http://www.sciencefestival.co.uk">festival web site</a>.
	</p>

	<p>
	Note that there are an awful lot of 'activities' shown, if you are not interested in these you should uncheck the 'activity' checkbox.
	</p>
     <div id="timemap_fjz">
        <div id="timelinecontainer_fjz">
          <div id="timeline_fjz" class="timeline"></div>
        </div>
        <div id="mapcontainer_fjz">
          <div id="map_fjz" class="map"></div>
        </div>
    </div>
    
    	<div class="checkboxList">
		<div class="title">Types of event:
		<input checked="checked" class="checkbox" id="activity_checkbox" type="checkbox"><span class="label">Activity</span> 
		<input checked="checked" type="checkbox" id="film_checkbox"><span class="label">Film</span> 
		<input checked="checked" type="checkbox" id="show_checkbox"><span class="label">Show</span> 
		<input checked="checked" type="checkbox" id="talk_checkbox"><span class="label">Talk</span> 
		<input checked="checked" type="checkbox" id="tour_checkbox"><span class="label">Tour</span> 
		<input checked="checked" type="checkbox" id="workshop_checkbox"><span class="label">Workshop</span>
		</div>
	</div>

	<p>
	The timemap is implemented using a <a href="http://code.google.com/p/timemap/">MIT timemap</a> version 2.0.1. 
	The map being used is <a href="http://openlayers.org/">OpenLayers</a> with <a href="http://www.openstreetmap.org/">OpenStreetMap</a>.
	</p>
	
	<p>
	The icons are from wikimedia commons: <a href="http://commons.wikimedia.org/wiki/File:U%2B269B.svg">atom</a>, <a href="http://commons.wikimedia.org/wiki/File:Movie_stub_film.png">film</a> and <a href="http://commons.wikimedia.org/wiki/File:Gear_7.svg">gear</a>.
	</p>
	
	<p>
	I have no connection to the Edinburgh Science Festival so any mistakes in the data here are my fault.
	The data was scraped from the <a href="http://www.sciencefestival.co.uk">festival web site</a> on the 2nd March 2012.
	</p>
	
	<p>
	<a href="mailto:alan_leslie@ymail.com?Subject=Edinburgh Science festival timemap">
	Send Mail</a>
	</p>
</body></html>